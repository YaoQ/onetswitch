# Hardware Design

##Intro  
The design for ONetSwitch hardware, i.e. the FPGA part as Programmable Logic, commonly follows a Xilinx Vivado flow.  
Here we provide a reference tcl script and folder structure, which show a guideline to manage the project generation and organization in Vivado, with IP package and block design integration.  
All of our Getting-Started projects and reference designs are organized in this way.  

##Tcl Script  
###Project Root  
The folder is assigned as the _ROOT_, when it originally contains following
* _myproj_ (folder) stores all the design sources and tcl.  
* _myproj.tcl_ (script) to generate the project.  

###IP Designs  
All the design sources of user IPs are listed in the folder _ROOT/myproj/ip_.  
The IPs should be managed in each subfolder, e.g.,  
_ROOT/myproj/ip/my_ip_0, ROOT/myproj/ip/my_ip_1, ... ROOT/myproj/ip/my_ip_n_  

In each IP folder, e.g., _ROOT/myproj/ip/my_ip_n_, contains typically  
* _src_ (folder) contains all design sources - hdl, netlist..  
* _my_ip_n.tcl_ (script) to package single IP to a zip for an IP-repository.  

To generate or modify _my_ip_n.tcl_, please follow the Vivado IP flow.  

###IP Repository  
The script _myproj.tcl_ fetches the _ip_list_ and then sources all the _my_ip_n.tcl_, storing the zip in a newly created folder _ip-repo_ in the _ROOT_.  
The _ip-repo_ is a runtime folder for IP generation and package.  

Modify the _ip_list_ variable in "myproj.tcl" to add IPs to your block design.  

###Block Design  
Only one block design can be supported in this tcl script.  
The system block design can be created by sourcing _ROOT/myproj/bd/myproj_bd.tcl_  
The _myproj.tcl_ automatically generates the wrapper for the block design.  

The _myproj_bd.tcl_ can be generated by running _write_bd_tcl_ after a complete
block design in Vivado. Please follow Vivado tcl scripting guide for details.  

###Sources and Constraints  
Common hdl, netlist and constraint files can be stored and organized in _ROOT/myproj/sources_ and _ROOT/myproj/constrs_  
Hierarchical folder structure is allowed.  

Simply modify the _source_files_ and _constr_files_ variables in _myproj.tcl_ to
add these sources to your design.  

###Project Generation  
In the Vivado tcl shell, change directory to the _ROOT_ and simply source the tcl. e.g.,  
```bash
cd ROOT
source myproj.tcl
```

The tcl collects all IPs, blockdesign(s), common hdl/netlist/constraints and
then generates the project.  
Synthesis and implementation flows can be added after that.  

###Project Cleanup
Manually (and carefully) delete all files and folders **except** following
* _myproj_ (folder) stores all the design sources and tcl.
* _myproj.tcl_ (script) to generate the project.
